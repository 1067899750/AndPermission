<!DOCTYPE HTML> <html lang=""> <head> <meta charset="UTF-8"> <meta content="text/html; charset=utf-8" http-equiv="Content-Type"> <title>Runtime Permissons Â· GitBook</title> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <meta name="description" content=""> <meta name="generator" content="GitBook 3.2.3"> <link rel="stylesheet" href="../gitbook/style.css"> <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css"> <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css"> <meta name="HandheldFriendly" content="true"/> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png"> <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon"> <link rel="next" href="constant.html"/> <link rel="prev" href="../"/> </head> <body> <div class="book"> <div class="book-summary"> <div id="book-search-input" role="search"> <input type="text" placeholder="Type to search"/> </div> <nav role="navigation"> <ul class="summary"> <li class="chapter " data-level="1.1" data-path="../"> <a href="../"> Introduction </a> </li> <li class="chapter active" data-level="1.2" data-path="./"> <a href="./"> Runtime Permissons </a> <ul class="articles"> <li class="chapter " data-level="1.2.1" data-path="constant.html"> <a href="constant.html"> Permission Constants </a> </li> </ul> </li> <li class="chapter " data-level="1.3" data-path="../install/"> <a href="../install/"> Instal App </a> </li> <li class="chapter " data-level="1.4" data-path="../overlay/"> <a href="../overlay/"> Overlay Drawing </a> </li> <li class="chapter " data-level="1.5" data-path="../fileuri/"> <a href="../fileuri/"> Share Private Files </a> </li> <li class="divider"></li> <li> <a href="https://www.gitbook.com" target="blank" class="gitbook-link"> Published with GitBook </a> </li> </ul> </nav> </div> <div class="book-body"> <div class="body-inner"> <div class="book-header" role="navigation"> <h1> <i class="fa fa-circle-o-notch fa-spin"></i> <a href="..">Runtime Permissons</a> </h1> </div> <div class="page-wrapper" tabindex="-1" role="main"> <div class="page-inner"> <div id="book-search-results"> <div class="search-noresults"> <section class="normal markdown-section"> <h1 id="request-runtime-permission">Request runtime permission</h1> <p>AndPermission can request permission with Activity or Fragment:</p> <pre><code>AndPermission.with(context)
    ...

AndPermission.with(fragment)
    ...
</code></pre><h2 id="basic-api">Basic Api</h2> <p>Request a single permission:</p> <pre><code class="lang-java">AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(Permission.WRITE_EXTERNAL_STORAGE)
    .onGranted(<span class="hljs-keyword">new</span> Action() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAction</span><span class="hljs-params">(List&lt;String&gt; permissions)</span> </span>{
            <span class="hljs-comment">// TODO what to do.</span>
        }
    }).onDenied(<span class="hljs-keyword">new</span> Action() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAction</span><span class="hljs-params">(List&lt;String&gt; permissions)</span> </span>{
            <span class="hljs-comment">// TODO what to do</span>
        }
    })
    .start();
</code></pre> <p>Request a single permission group:</p> <pre><code class="lang-java">AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(Permission.Group.STORAGE)
    ...
</code></pre> <p>Request a few permissions:</p> <pre><code class="lang-java">AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(
        Permission.WRITE_EXTERNAL_STORAGE,
        Permission.CAMERA
    )
    ...
</code></pre> <p>Request a few permission groups:</p> <pre><code class="lang-java">AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(
        Permission.Group.STORAGE,
        Permission.Group.CAMERA
    )
    ...
</code></pre> <h2 id="when-rejected">When rejected</h2> <p>Users often do not authorize some permissions, and we happen to have to use these permissions, this time we should be friendly reminder user. </p> <p>For example, when the user denies <code>Permission.WRITE_EXTERNAL_STORAGE</code> once, the next time we request <code>Permission.WRITE_EXTERNAL_STORAGE</code>, we should show why this permission is needed so that users can determine if they need to be authorized. In AndPermission we can use Rationale.</p> <pre><code class="lang-java"><span class="hljs-keyword">private</span> Rationale mRationale = <span class="hljs-keyword">new</span> Rationale() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showRationale</span><span class="hljs-params">(Context context, List&lt;String&gt; permissions, 
            RequestExecutor executor)</span> </span>{
        <span class="hljs-comment">// Here should display a Dialog to ask the user whether to continue.</span>

        <span class="hljs-comment">// When the user to continue the request:</span>
        executor.execute();

        <span class="hljs-comment">// When the user interrupts the request:</span>
        executor.cancel();
    }
};

AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(Permission.WRITE_EXTERNAL_STORAGE)
    .rationale(mRationale)
    .onGranted(...)
    .onDenied(...)
    .start();
</code></pre> <h2 id="when-always-rejected">When always rejected</h2> <p>The application may not respond (not ANR) when a user clicks on one of the application&apos;s buttons and he always rejects one of the permissions we need. In order to avoid this situation, we should prompt the user to open permission in the system when the user always rejects the permission, regardless of whether the user will really allow.</p> <pre><code class="lang-java">AndPermission.with(<span class="hljs-keyword">this</span>)
    .runtime()
    .permission(...)
    .rationale(...)
    .onGranted(...)
    .onDenied(<span class="hljs-keyword">new</span> Action() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAction</span><span class="hljs-params">(List&lt;String&gt; permissions)</span> </span>{
            <span class="hljs-keyword">if</span> (AndPermission.hasAlwaysDeniedPermission(context, permissions)) {
                <span class="hljs-comment">// These permissions are always rejected by the user.</span>
            }
        }
    })
    .start();
</code></pre> <p>Next you can prompt the user to open the system settings to allow us the required permissions.</p> <pre><code class="lang-java">...

<span class="hljs-keyword">if</span> (AndPermission.hasAlwaysDeniedPermission(context, permissions)) {
    <span class="hljs-comment">// Here should display a Dialog to ask the user whether to setting.</span>
    AndPermission.with(<span class="hljs-keyword">this</span>)
        .runtime()
        .setting()
        .onComeback(<span class="hljs-keyword">new</span> Setting.Action() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAction</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-comment">// The user is back from the settings.</span>
            }
        })
        .start();
}
</code></pre> <p>Of course, we need to prompt the user to allow what permissions, look here: <a href="../permission.md">Permission constants</a>.</p> </section> </div> <div class="search-results"> <div class="has-results"> <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1> <ul class="search-results-list"></ul> </div> <div class="no-results"> <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1> </div> </div> </div> </div> </div> </div> <a href="../" class="navigation navigation-prev " aria-label="Previous page: Introduction"> <i class="fa fa-angle-left"></i> </a> <a href="constant.html" class="navigation navigation-next " aria-label="Next page: Permission Constants"> <i class="fa fa-angle-right"></i> </a> </div> <script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"Runtime Permissons",level:"1.2",depth:1,next:{title:"Permission Constants",level:"1.2.1",depth:2,path:"runtime/constant.md",ref:"runtime/constant.md",articles:[]},previous:{title:"Introduction",level:"1.1",depth:1,path:"README.md",ref:"README.md",articles:[]},dir:"ltr"},config:{gitbook:"*",theme:"default",variables:{},plugins:[],pluginsConfig:{highlight:{},search:{},lunr:{maxIndexSize:1000000,ignoreSpecialCharacters:false},sharing:{facebook:true,twitter:true,google:false,weibo:false,instapaper:false,vk:false,all:["facebook","google","twitter","weibo","instapaper"]},fontsettings:{theme:"white",family:"sans",size:2},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:false}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},pdf:{pageNumbers:true,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"}},file:{path:"runtime/README.md",mtime:"2018-06-02T15:44:40.995Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2018-06-02T15:56:55.623Z"},basePath:"..",book:{language:""}})});</script> </div> <script src="../gitbook/gitbook.js"></script> <script src="../gitbook/theme.js"></script> <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script> <script src="../gitbook/gitbook-plugin-search/search.js"></script> <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script> <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script> <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script> <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script> </body> </html>